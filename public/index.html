<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Space Education Hub</title>
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- Firebase SDKs -->
    <script defer src="/__/firebase/12.4.0/firebase-app-compat.js"></script>
    <script defer src="/__/firebase/12.4.0/firebase-auth-compat.js"></script>
    <script
      defer
      src="/__/firebase/12.4.0/firebase-firestore-compat.js"
    ></script>
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>
    <style>
      :root {
        --primary: #2c3e50;
        --secondary: #3498db;
        --accent: #e74c3c;
        --bg: #f5f6fa;
        --white: #fff;
        --shadow: 0 2px 8px rgba(44, 62, 80, 0.08);
      }
      body {
        font-family: "Roboto", Arial, sans-serif;
        background: var(--bg);
        color: var(--primary);
        margin: 0;
        padding: 0;
      }
      header {
        background: var(--primary);
        color: var(--white);
        padding: 1.5rem 0;
        text-align: center;
        box-shadow: var(--shadow);
      }
      header h1 {
        margin: 0;
        font-size: 2.2rem;
        font-weight: 700;
        letter-spacing: 1px;
      }
      .container {
        max-width: 900px;
        margin: 2rem auto;
        padding: 0 1rem;
      }
      .auth-section {
        display: flex;
        gap: 2rem;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 2.5rem;
      }
      .auth-card {
        background: var(--white);
        border-radius: 8px;
        box-shadow: var(--shadow);
        padding: 2rem 1.5rem;
        width: 320px;
        min-width: 260px;
      }
      .auth-card h2 {
        margin-top: 0;
        font-size: 1.3rem;
        color: var(--secondary);
        font-weight: 500;
        margin-bottom: 1rem;
      }
      .auth-card form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .auth-card input {
        padding: 0.7rem;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        font-size: 1rem;
        outline: none;
        transition: border 0.2s;
      }
      .auth-card input:focus {
        border-color: var(--secondary);
      }
      .auth-card button {
        background: var(--secondary);
        color: var(--white);
        border: none;
        padding: 0.7rem;
        border-radius: 4px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
      }
      .auth-card button:hover {
        background: #217dbb;
      }
      .auth-card .error {
        color: var(--accent);
        font-size: 0.95rem;
        margin-top: -0.5rem;
      }
      .school-section {
        background: var(--white);
        border-radius: 8px;
        box-shadow: var(--shadow);
        padding: 2rem 1.5rem;
        margin-bottom: 2rem;
      }
      .school-section h2 {
        color: var(--primary);
        font-size: 1.4rem;
        margin-top: 0;
        margin-bottom: 1.2rem;
        font-weight: 600;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
      }
      th,
      td {
        padding: 0.8rem;
        text-align: left;
        border-bottom: 1px solid #e1e4e8;
      }
      th {
        background: var(--bg);
        color: var(--primary);
        font-weight: 500;
      }
      tr:last-child td {
        border-bottom: none;
      }
      footer {
        background: var(--primary);
        color: var(--white);
        text-align: center;
        padding: 1.2rem 0;
        margin-top: 3rem;
      }
      @media (max-width: 700px) {
        .auth-section {
          flex-direction: column;
          align-items: center;
        }
        .container {
          padding: 0 0.5rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Space Education Hub</h1>
      <p
        style="
          margin: 0.5rem 0 0;
          font-weight: 400;
          font-size: 1.1rem;
          color: #b0c4d9;
        "
      >
        Explore, Learn, and Connect with Schools
      </p>
    </header>
    <div class="container">
      <section class="auth-section">
        <!-- Sign Up -->
        <div class="auth-card" id="signup-card">
          <h2>Sign Up</h2>
          <form id="signup-form">
            <input
              type="email"
              id="signup-email"
              placeholder="Email"
              required
            />
            <input
              type="password"
              id="signup-password"
              placeholder="Password"
              required
            />
            <button type="submit">Create Account</button>
            <div class="error" id="signup-error"></div>
          </form>
        </div>
        <!-- Sign In -->
        <div class="auth-card" id="signin-card">
          <h2>Sign In</h2>
          <form id="signin-form">
            <input
              type="email"
              id="signin-email"
              placeholder="Email"
              required
            />
            <input
              type="password"
              id="signin-password"
              placeholder="Password"
              required
            />
            <button type="submit">Sign In</button>
            <div class="error" id="signin-error"></div>
          </form>
        </div>
      </section>
      <!-- School Info Section -->
      <section class="school-section">
        <h2>Our Partner Schools</h2>
        <div
          style="margin-bottom: 1rem; display: flex; gap: 1rem; flex-wrap: wrap"
        >
          <label>
            Province:
            <select id="province-filter">
              <option value="">All</option>
            </select>
          </label>
          <label>
            <input type="checkbox" id="underserved-filter" />
            Underserved only
          </label>
        </div>
        <table id="schools-table">
          <thead>
            <tr>
              <th>School Name</th>
              <th>Province</th>
              <th>Underserved</th>
              <th>Location</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="4" style="text-align: center">Loading...</td>
            </tr>
          </tbody>
        </table>
      </section>
    </div>
    <footer>&copy; 2025 Space Education Hub. All rights reserved.</footer>
    <script>
      // Firebase Auth: Sign Up
      document
        .getElementById("signup-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const email = document.getElementById("signup-email").value;
          const password = document.getElementById("signup-password").value;
          const errorDiv = document.getElementById("signup-error");
          errorDiv.textContent = "";
          try {
            await firebase
              .auth()
              .createUserWithEmailAndPassword(email, password);
            errorDiv.style.color = "green";
            errorDiv.textContent = "Account created! You can now sign in.";
          } catch (err) {
            errorDiv.style.color = "#E74C3C";
            errorDiv.textContent = err.message;
          }
        });

      // Firebase Auth: Sign In
      document
        .getElementById("signin-form")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const email = document.getElementById("signin-email").value;
          const password = document.getElementById("signin-password").value;
          const errorDiv = document.getElementById("signin-error");
          errorDiv.textContent = "";
          try {
            await firebase.auth().signInWithEmailAndPassword(email, password);
            errorDiv.style.color = "green";
            errorDiv.textContent = "Signed in! Welcome.";
          } catch (err) {
            errorDiv.style.color = "#E74C3C";
            errorDiv.textContent = err.message;
          }
        });

      // Fetch and display schools
      let schoolsData = [];
      const tableBody = document.querySelector("#schools-table tbody");
      const provinceFilter = document.getElementById("province-filter");
      const underservedFilter = document.getElementById("underserved-filter");

      fetch("schools.json")
        .then((res) => res.json())
        .then((data) => {
          schoolsData = data;
          populateProvinceFilter(data);
          renderTable();
        });

      function populateProvinceFilter(data) {
        const provinces = Array.from(
          new Set(data.map((s) => s.province))
        ).sort();
        provinces.forEach((prov) => {
          const opt = document.createElement("option");
          opt.value = prov;
          opt.textContent = prov;
          provinceFilter.appendChild(opt);
        });
      }

      function renderTable() {
        const province = provinceFilter.value;
        const underserved = underservedFilter.checked;
        let filtered = schoolsData;
        if (province)
          filtered = filtered.filter((s) => s.province === province);
        if (underserved) filtered = filtered.filter((s) => s.isUnderserved);
        if (filtered.length === 0) {
          tableBody.innerHTML = `<tr><td colspan="4" style="text-align:center;">No schools found.</td></tr>`;
          return;
        }
        tableBody.innerHTML = filtered
          .map(
            (s) => `
          <tr>
            <td>${s.name}</td>
            <td>${s.province}</td>
            <td>
              ${
                s.isUnderserved
                  ? '<span style="color:var(--accent);font-weight:500;">Yes</span>'
                  : '<span style="color:var(--secondary);">No</span>'
              }
            </td>
            <td>
              <a href="https://maps.google.com/?q=${s.location.lat},${
              s.location.lng
            }" target="_blank" style="color:var(--secondary);text-decoration:underline;">
                View Map
              </a>
            </td>
          </tr>
        `
          )
          .join("");
      }

      provinceFilter.addEventListener("change", renderTable);
      underservedFilter.addEventListener("change", renderTable);
    </script>
  </body>
</html>
